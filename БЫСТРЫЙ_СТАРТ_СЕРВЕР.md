# ⚡ Быстрый старт: Развертывание на сервере за 15 минут

## Для тех, кто хочет быстро!

Если ты уже знаком с Linux или просто хочешь быстро развернуть сайт, следуй этой короткой инструкции.

---

## 🔑 Подключение к серверу

```bash
ssh root@38.242.128.68
# Пароль: jb2Wqw8RaJ7d
```

---

## 🚀 Автоматическое развертывание

### Вариант 1: Используя скрипт (рекомендуется)

**На сервере:**

```bash
# Скачать скрипт развертывания
cd /root
wget https://raw.githubusercontent.com/YOUR_REPO/deploy.sh
# или скопируй файл deploy.sh на сервер

# Запустить
bash deploy.sh
```

Скрипт попросит скопировать файлы проекта. Используй SCP:

**На твоем компьютере (PowerShell):**

```powershell
cd "C:\Users\user\Desktop\DMT_prod\DMT_serv\DMT_cursor-v7(serv)"
scp -r * root@38.242.128.68:/var/www/dmt.expert/
```

---

### Вариант 2: Вручную (10 команд)

**На сервере выполни по порядку:**

```bash
# 1. Обновление и установка
apt update && apt upgrade -y
apt install -y python3 python3-pip python3-venv nginx git certbot python3-certbot-nginx ufw

# 2. Создание структуры
mkdir -p /var/www/dmt.expert
cd /var/www/dmt.expert
```

**Скопируй файлы с компьютера:**

```powershell
# На твоем Windows
scp -r * root@38.242.128.68:/var/www/dmt.expert/
```

**Продолжи на сервере:**

```bash
# 3. Python окружение
cd /var/www/dmt.expert
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt gunicorn

# 4. Переменные окружения
cat > .env << EOF
FLASK_ENV=production
SECRET_KEY=$(python3 -c 'import secrets; print(secrets.token_hex(32))')
EOF

# 5. Systemd служба
cat > /etc/systemd/system/dmt.service << 'EOF'
[Unit]
Description=DMT Document Generation Service
After=network.target

[Service]
User=root
Group=root
WorkingDirectory=/var/www/dmt.expert
Environment="PATH=/var/www/dmt.expert/venv/bin"
Environment="FLASK_ENV=production"
ExecStart=/var/www/dmt.expert/venv/bin/gunicorn --workers 3 --bind 127.0.0.1:5000 app:app
Restart=always

[Install]
WantedBy=multi-user.target
EOF

systemctl daemon-reload
systemctl start dmt
systemctl enable dmt

# 6. Nginx конфигурация
cat > /etc/nginx/sites-available/dmt.expert << 'EOF'
server {
    listen 80;
    server_name dmt.expert www.dmt.expert;
    client_max_body_size 20M;

    location / {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
EOF

ln -sf /etc/nginx/sites-available/dmt.expert /etc/nginx/sites-enabled/
rm -f /etc/nginx/sites-enabled/default
nginx -t && systemctl restart nginx

# 7. Firewall
ufw --force enable
ufw allow OpenSSH
ufw allow 'Nginx Full'

# 8. Директории
mkdir -p logs created_docx /backups
```

---

## 🌐 Настройка DNS

**В панели управления доменом:**

| Тип | Имя | Значение | TTL |
|-----|-----|----------|-----|
| A   | @   | 38.242.128.68 | 3600 |
| A   | www | 38.242.128.68 | 3600 |

**Проверка (на твоем компьютере):**

```powershell
nslookup dmt.expert
```

Должен показать: `38.242.128.68`

⏳ **Подожди 15-30 минут** пока DNS обновится.

---

## 🔐 SSL сертификат

**После настройки DNS (важно!):**

```bash
certbot --nginx -d dmt.expert -d www.dmt.expert
```

Ответь на вопросы:
- Email: твоя почта
- Согласие: Y
- Новости: N
- Redirect: 2

---

## ✅ Проверка

```bash
# Статус служб
systemctl status dmt
systemctl status nginx

# Открой в браузере
https://dmt.expert
```

---

## 🔄 Обновление (в будущем)

```bash
cd /var/www/dmt.expert
source venv/bin/activate
# Скопируй новые файлы через SCP
pip install -r requirements.txt
systemctl restart dmt
```

Или используй скрипт:

```bash
bash /var/www/dmt.expert/update.sh
```

---

## 🛠️ Основные команды

```bash
# Перезапуск
systemctl restart dmt

# Логи
journalctl -u dmt -f

# Статус
systemctl status dmt nginx

# Бэкап
tar -czf /backups/backup-$(date +%Y%m%d).tar.gz /var/www/dmt.expert
```

---

## 🚨 Если что-то не работает

### Сайт не открывается

```bash
# Проверить службы
systemctl status dmt nginx

# Перезапустить
systemctl restart dmt nginx

# Логи
journalctl -u dmt -n 50
```

### 502 Bad Gateway

```bash
systemctl restart dmt
netstat -tulpn | grep 5000
```

### 500 Internal Server Error

```bash
journalctl -u dmt -n 100
```

---

## 📞 Полезные файлы

- **Подробная инструкция:** `ИНСТРУКЦИЯ_РАЗВЕРТЫВАНИЯ_НА_СЕРВЕРЕ.md`
- **Команды:** `server_commands.md`
- **Скрипт обновления:** `update.sh`

---

## 🎉 Готово!

Твой сайт работает на **https://dmt.expert**

Время развертывания: **10-15 минут** + ожидание DNS (15-30 минут)


